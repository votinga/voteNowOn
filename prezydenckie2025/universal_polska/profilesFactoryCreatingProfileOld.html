<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emitter of decentralized identity and confirmations of officially release digital identity</title>
<style>
    .button-container {
        margin-top: 20px;
    }
    button {
        margin-right: 10px;
        padding: 10px;
    }
    .view {
        border: 4px solid blue;
    }
    .nonpayable {
        border: 4px solid orange;
    }
    .payable {
        border: 4px solid gold;
    }
    #messageBox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
 
		height:auto;
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        padding: 10px;
        box-sizing: border-box;
        overflow: scroll;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    select {
        width: 300px;
    }
    
    #pesel{
        width: 300px;
    }

    body{
        font-size: 24px;
    }
</style>
</head>
<body>
<div id="messageBox">Ready...</div>
<br>
<br>
<br>

<h1>create your own Decentralized Digital Identity using Factory of Profiles</h1>
<a href="#encryptionForm"><button>Calculate UniqueId</button></a><br>
<h2> Use the SSN number or ther used also in classical official registry for voting in your state.</h2>
<select id="abiSelector"></select>
<button onclick="loadSelectedContract()">Click to show input form</button>
<div id="contractFunctions"></div>

<script src="./ethers.umd.js"></script>
<script>
	const keccak256 = ethers.keccak256;
    const abiFolderPath = './1profilesFactoryJustCreate/';

    async function listABIs() {
        // Simulated API call to list files, replace with your own backend or static list
        const files = ['0xa029c1c1710fc74dbeb125ce02c9a3469ca8079f.PolskaFabrykaProfiliVotinga.abi']; // Example static list
        const selector = document.getElementById('abiSelector');
        files.forEach(file => {
            const option = document.createElement('option');
            option.value = file;
            option.innerText = file.split('.')[0]; // Remove '.abi' for display
            selector.appendChild(option);
        });
    }

    async function loadSelectedContract() {
        const selector = document.getElementById('abiSelector');
        const abiFile = selector.value;
        const contractAddress = abiFile.split('.')[0]; // Assumes ABI filename first part before first dot is the address
        const contractABI = await fetch(abiFolderPath + abiFile).then(response => response.json());
        loadContractFunctions(contractAddress, contractABI);
    }
	
	
async function initialize() {
  const provider = new ethers.BrowserProvider(window.ethereum);
  const signer = await provider.getSigner();

  console.log("Signer address:", await signer.getAddress());
}


    async function loadContractFunctions(contractAddress, contractABI) {
        const provider = new ethers.BrowserProvider(window.ethereum);
		const signer = await provider.getSigner();

		console.log("Signer address:", await signer.getAddress())
        const contract = new ethers.Contract(contractAddress, contractABI, signer);

        const container = document.getElementById('contractFunctions');
        container.innerHTML = '';
        contractABI.forEach(func => {
            if (func.type === "function") {
                const funcDiv = document.createElement('div');
                funcDiv.className = func.stateMutability;

                const button = document.createElement('button');
                button.textContent = func.name;
                button.className = func.stateMutability === 'view' || func.stateMutability === 'pure' ? 'view' :
                                    func.stateMutability === 'payable' ? 'payable' : 'nonpayable';

                const inputsDiv = document.createElement('div');
                func.inputs.forEach(input => {
                    const pads = document.createElement('p');
                    pads.textContent ='________________________________________________';
                    const inputLabel = document.createElement('label');
                    inputLabel.textContent = input.name + ' (' + input.type + '): ';
                    const inputElement = document.createElement('input');
                    inputElement.setAttribute('id', func.name + '_' + input.name);
                    inputElement.setAttribute('type', 'text');
                    inputsDiv.appendChild(pads);
                    inputsDiv.appendChild(inputLabel);
                    inputsDiv.appendChild(inputElement);
                });

                button.addEventListener('click', async () => {
                    const args = func.inputs.map(input => {
                        const inputValue = document.getElementById(func.name + '_' + input.name).value;
                        return inputValue;
                    });
                    try {
                        const result = await contract[func.name](...args);
                        console.log(result);
                        document.getElementById('messageBox').innerText = `Function executed. Result: ${JSON.stringify(result).replace(/,/g, '\n')}`;
                    } catch (error) {
                        console.error(error);
                        document.getElementById('messageBox').innerText = 'Error: ' + error.message;
                    }
                });

                funcDiv.appendChild(button);
                funcDiv.appendChild(inputsDiv);
                container.appendChild(funcDiv);
            }
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        listABIs();
    });


    function encrypt() {
            const peselInput = document.getElementById('pesel').value;
            const encryptedUniqueId = keccak256(ethers.toUtf8Bytes(peselInput));
            document.getElementById('encryptedUniqueId').value = encryptedUniqueId;

            // Set the UniqueID field in the profileForm to the encrypted value
            document.getElementById('encryptedUniqueId').value = encryptedUniqueId;
        }
</script>
<footer>

    <h2>UniqueID Encryption</h2>
    <form id="encryptionForm">
        <label for="pesel">UniqueID (Your PESEL): see instructions page how build Unique ID in details in general it is : <br>
            “USA” + State Code -see table below + your Social Security Number + YYYYMMDD - your birth date <br>
            example USAILLSSNSSNSSNSSNSSN20001201 <br>
        </label>

        <input type="text" id="pesel" name="pesel">
        <button type="button" onclick="encrypt()">Encrypt / keccack256 </button><br><br>

        <label for="encryptedUniqueId">Encrypted / hash UniqueID:</label>
        <input type="text" id="encryptedUniqueId" name="encryptedUniqueId" readonly>
    </form>
    

    <br>
Explorers <br>

<a href="https://polygonscan.com/">Polygon block scanner etherscan indexer</a><br>
<br>
<br>Alabama - ALA
<br>Alaska - ALK
<br>Arizona - ARZ
<br>Arkansas - ARK
<br>California - CAL
<br>Colorado - COL
<br>Connecticut - CON
<br>Delaware - DEL
<br>District of Columbia - DoC
<br>Florida - FLA
<br>Georgia - GEO
<br>Hawaii - HAW
<br>Idaho - IDA
<br>Illinois - ILL
<br>Indiana - IND
<br>Iowa - IOW
<br>Kansas - KAN
<br>Kentucky - KEN
<br>Louisiana - LOU
<br>Maine - MAI
<br>Maryland - MAR
<br>Massachusetts - MAS
<br>Michigan - MIC
<br>Minnesota - MIN
<br>Mississippi - MIS
<br>Missouri - MOS
<br>Montana - MON
<br>Nebraska - NEB
<br>Nevada - NEV
<br>New Hampshire - NHM
<br>New Jersey - NJY
<br>New Mexico - NMX
<br>New York - NYK
<br>North Carolina - NCL
<br>North Dakota - NDA
<br>Ohio - OHI
<br>Oklahoma - OKL
<br>Oregon - ORG
<br>Pennsylvania - PEN
<br>Rhode Island - RHO
<br>South Carolina - SCL
<br>South Dakota - SDA
<br>Tennessee - TEN
<br>Texas - TEX
<br>Utah - UTA
<br>Vermont - VER
<br>Virginia - VIR
<br>Washington - WAS
<br>West Virginia - WVR
<br>Wisconsin - WIS
<br>Wyoming - WYO


</footer>
</body>
</html>
