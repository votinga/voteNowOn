<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Votinga PL: Tworzenie Profilu Tożsamości Zdecentralizowanej </title>
    <style>
        body {
            font-size: 24px;
            background-color: #ffffff;
            color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            text-align: center;
        }

        button {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 10px auto;
            padding: 10px;
            background-color: #d2691e; /* ciemny pomarańcz */
            color: #ffffff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 24px;
        }

        button:hover {
            background-color: #8b4513; /* ciemny brąz */
        }
    </style>
</head>
<body>
    <div id="messageBox">Votinga Protocol </div>
    <br>
    <br>
    <br>
    
    <h1>  Czy używać votinga Protocol i technologii blochcain do dialogu społecznego i decyzji w Polsce.</h1>
    <h3> 0x9Ef737b0C422986F9398b6560c7F93B0f8682B1C ,  Token głosu do pytania. Kliknij pokażd funkcję. Pobierz głos.  </h3>
    <br> kliknij by zobaczyć opis zapytania zapisany w inteligentym kontrakcie.
    <select id="abiSelector"></select>
    <button onclick="loadSelectedContract()">Pokaż funkcje</button>
    <div id="contractFunctions"></div>
    
    <script src="./ethers.umd.js"></script>
    <script>
        const abiFolderPath = './5votings/';
    
        async function listABIs() {
            // Simulated API call to list files, replace with your own backend or static list
            const files = ['0x8EBC94631E7604df6152c160173AE64c29340c0c.PLvotingGetTokenOfGeneralVoting.VotingaInPoland.abi',]; // Example static list
            const selector = document.getElementById('abiSelector');
            files.forEach(file => {
                const option = document.createElement('option');
                option.value = file;
                option.innerText = file.split('.')[0]; // Remove '.abi' for display
                selector.appendChild(option);
            });
        }
    
        async function loadSelectedContract() {
            const selector = document.getElementById('abiSelector');
            const abiFile = selector.value;
            const contractAddress = abiFile.split('.')[0]; // Assumes ABI filename is the address
            const contractABI = await fetch(abiFolderPath + abiFile).then(response => response.json());
            loadContractFunctions(contractAddress, contractABI);
        }
    
        async function loadContractFunctions(contractAddress, contractABI) {
            const provider = new ethers.BrowserProvider(window.ethereum);
            const signer = await provider.getSigner();
            const contract = new ethers.Contract(contractAddress, contractABI, signer);
    
            const container = document.getElementById('contractFunctions');
            container.innerHTML = '';
            contractABI.forEach(func => {
                if (func.type === "function") {
                    const funcDiv = document.createElement('div');
                    funcDiv.className = func.stateMutability;
    
                    const button = document.createElement('button');
                    button.textContent = func.name;
                    button.className = func.stateMutability === 'view' || func.stateMutability === 'pure' ? 'view' :
                                        func.stateMutability === 'payable' ? 'payable' : 'nonpayable';
    
                    const inputsDiv = document.createElement('div');
                    func.inputs.forEach(input => {
                        const inputLabel = document.createElement('label');
                        inputLabel.textContent = input.name + ' (' + input.type + '): ';
                        const inputElement = document.createElement('input');
                        inputElement.setAttribute('id', func.name + '_' + input.name);
                        inputElement.setAttribute('type', 'text');
                        inputsDiv.appendChild(inputLabel);
                        inputsDiv.appendChild(inputElement);
                    });
    
                    button.addEventListener('click', async () => {
                        const args = func.inputs.map(input => {
                            const inputValue = document.getElementById(func.name + '_' + input.name).value;
                            return inputValue;
                        });
                        try {
                            const result = await contract[func.name](...args);
                            console.log(result);
                            document.getElementById('messageBox').innerText = `Function executed. Result: ${JSON.stringify(result)}`;
                        } catch (error) {
                            console.error(error);
                            document.getElementById('messageBox').innerText = 'Error: ' + error.message;
                        }
                    });
    
                    funcDiv.appendChild(button);
                    funcDiv.appendChild(inputsDiv);
                    container.appendChild(funcDiv);
                }
            });
        }
    
        window.addEventListener('DOMContentLoaded', (event) => {
            listABIs();
        });
    </script>
    </body>
</html>
