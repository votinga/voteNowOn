<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Votinga: Verification of response content</title>
<style>
    .button-container {
        margin-top: 20px;
    }
    button {
        margin-right: 10px;
        padding: 10px;
    }
    .view {
        border: 4px solid blue;
    }
    .nonpayable {
        border: 4px solid orange;
    }
    .payable {
        border: 4px solid gold;
    }
    #messageBox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 200px;
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        padding: 10px;
        box-sizing: border-box;
        overflow: scroll;
        text-overflow: ellipsis;
        white-space: wrap;
    }
    select {
        width: auto;
    }

    body{
        font-size:28px;
    }
</style>
</head>
<body>
<div id="messageBox">Welcome to Votinga. Note. All actions on blockchain are unreversible.</div>
<br>
<br>
<br>

<h1>Responses in votings using Votinga and their descriptions on blockchain </h1>
<select id="abiSelector"></select>
<button onclick="loadSelectedContract()">Show Contract Functionalities</button>
<div id="contractFunctions"></div>

<script src="./ethers.umd.js"></script>
<script>
    const abiFolderPath = './13responses/';

    async function listABIs() {
        // Simulated API call to list files, replace with your own backend or static list
        const files = 
        ['0x569CAA8cff71430D12820757f940bb1B59c01E1D.POLSKAprezydenckie.Trzaskowski.abi'
,'0x1157Dc75c863B9aa4e3FCBa29E1e2Bc4f7aa944e.POLSKAprezydenckie.Nawrocki.abi'
,'0x394a7bFb89a906bbd52171396e23A7Ea742F35Dd.POLSKAprezydenckie.Sikorski.abi'
,'0x2aF02635D0587587570914698f1572d46Ca0730a.POLSKAprezydenckie.Bartoszewicz.abi'
,'0xAE48999079698267d9a063d1769524B92D5f9571.POLSKAprezydenckie.Senyszyn.abi'
,'0x92A1dc25f38cf99A1beEf03e177f60Bd762B9612.POLSKAprezydenckie.Jakubiak.abi'
,'0xaD37555AD87b21259C092db826b35133B26eB0f6.POLSKAprezydenckie.Braun.abi'
,'0x158eDEafeb74cafFF1C7373c1b15F559F171BBD2.POLSKAprezydenckie.Zandberg.abi'
,'0x69B8e2a6BB48c85a42BB1531dEd7E325ED26Fd40.POLSKAprezydenckie.Biejat.abi'
,'0x433a021B5F08b562d50Bc962CA75fE9Bf645a7e3.POLSKAprezydenckie.Mentzen.abi'
,'0xfe19212e44B79Bef75601755364056b661fA752f.POLSKAprezydenckie.HoÅ‚ownia.abi'
,'0x9C7D3aeA58bB33640a48217ea6050Bb2D3b1BB3F.POLSKAprezydenckie.Stanowski.abi']; // Example static list
        const selector = document.getElementById('abiSelector');
        files.forEach(file => {
            const option = document.createElement('option');
            option.value = file;
            option.innerText = file;//.split('.')[0]; // Remove '.abi' for display
            selector.appendChild(option);
        });
    }

    async function loadSelectedContract() {
        const selector = document.getElementById('abiSelector');
        const abiFile = selector.value;
        const contractAddress = abiFile.split('.')[0]; // '0xB0aaCbB4f9Fdc71325540d121AeE675ed61E204';// Assumes ABI filename is the address
        const contractABI = await fetch(abiFolderPath + abiFile).then(response => response.json());
        loadContractFunctions(contractAddress, contractABI);
    }

    async function loadContractFunctions(contractAddress, contractABI) {
        const provider = new ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();
        const contract = new ethers.Contract(contractAddress, contractABI, signer);

        const container = document.getElementById('contractFunctions');
        container.innerHTML = '';
        contractABI.forEach(func => {
            if (func.type === "function") {
                const funcDiv = document.createElement('div');
                funcDiv.className = func.stateMutability;

                const button = document.createElement('button');
                button.textContent = func.name;
                button.className = func.stateMutability === 'view' || func.stateMutability === 'pure' ? 'view' :
                                    func.stateMutability === 'payable' ? 'payable' : 'nonpayable';

                const inputsDiv = document.createElement('div');
                func.inputs.forEach(input => {
                    const inputLabel = document.createElement('label');
                    inputLabel.textContent = input.name + ' (' + input.type + '): ';
                    const inputElement = document.createElement('input');
                    inputElement.setAttribute('id', func.name + '_' + input.name);
                    inputElement.setAttribute('type', 'text');
                    inputsDiv.appendChild(inputLabel);
                    inputsDiv.appendChild(inputElement);
                });

                button.addEventListener('click', async () => {
                    const args = func.inputs.map(input => {
                        const inputValue = document.getElementById(func.name + '_' + input.name).value;
                        return inputValue;
                    });
                    try {
                        const result = await contract[func.name](...args);
                        console.log(result);
                        document.getElementById('messageBox').innerText = `Function executed. Result: ${JSON.stringify(result)}`;
                    } catch (error) {
                        console.error(error);
                        document.getElementById('messageBox').innerText = 'Error: ' + error.message;
                    }
                });

                funcDiv.appendChild(button);
                funcDiv.appendChild(inputsDiv);
                container.appendChild(funcDiv);
            }
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        listABIs();
    });
</script>
</body>
</html>
